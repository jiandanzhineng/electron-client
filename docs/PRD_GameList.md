# 游戏列表（GameList.vue）PRD

> 版本：v1.0
> 最近更新：2025-10-27

## 背景与目标

- 提供一个统一的“游戏/玩法”入口，支持本地内置玩法与外部玩法加载。
- 面向非技术用户，提供简单直观的搜索、筛选、启动、删除操作。
- 对“外部玩法”实现文件级集成与持久化索引，提升复用与二次打开体验。

## 用户角色

- 运营/主播：快速查找并启动玩法，查看设备依赖提示。
- 开发者/作者：通过“加载外部玩法”导入 JS 文件并在运行时进行配置与调试。

## 用户故事

- 作为用户，我能通过搜索或分类筛选快速定位玩法。
- 作为用户，我能一键加载外部玩法 JS 文件，并在后续自动被识别。
- 作为用户，我能启动玩法，外部玩法在启动前进入配置页面。
- 作为用户，我能删除不再需要的玩法并清理列表。

## 范围

- 包含：游戏列表展示、搜索/筛选、刷新、加载外部玩法、自动加载已保存玩法、启动、删除、设备需求展示。
- 不含：设备接入细节、具体玩法逻辑实现、账号体系、云端存储与同步。

## 术语与定义

- 外部玩法：以 JS 文件形式提供的玩法配置与逻辑（至少包含 `title`、`description`、`requiredDevices`、`start`、`loop`）。
- 设备需求：玩法声明所需的设备集合，包含必选与可选，用于运行前配置与校验。

## 功能需求（FR）

### FR-01 游戏列表展示

- 展示之前加载的和默认的游戏卡片：名称、描述、参数、最后游戏时间、设备需求。

### FR-02 搜索过滤

- 在搜索框输入关键词时，按名称进行大小写不敏感过滤。
- 空搜索时显示全部。

### FR-04 刷新玩法列表

- 点击“刷新”按钮
  - 清空现有游戏。
  - 重新扫描 `game` 目录下所有 JS 文件并加载。
  - 保存更新结果到本地存储。

### FR-05 加载外部玩法

- 点击“加载外部玩法”：
  - 打开系统文件选择器。
  - 选择 JS 文件后发送到后端：
    - 初次读取配置以获知玩法信息（`gameplayService.loadGameplayFromJS`）。
    - 复制到 `game` 目录（`copyGameplayFile`）。
    - 已存在同名则更新；否则新增条目。
  - 将原始文件内容与元信息保存到本地存储。

### FR-06 自动加载已保存玩法

- 页面加载时调用 `loadSavedGameplays` 的API：
  - 返回当前所有游戏的列表。

### FR-07 启动游戏

- 留空 等待实现。

### FR-08 停止游戏

- 留空 等待实现。

### FR-10 删除游戏

- 二次确认后调用 `gameStore.removeGame(game.id)`。

### FR-11 设备需求展示

- 对存在 `requiredDevices` 的游戏，在卡片上展示设备标签：必选以 `●` 标识、可选以 `○` 标识。

### FR-12 格式化显示

- 最后游戏时间：`formatDate(timestamp)` 使用 `toLocaleString('zh-CN')`。

### FR-13 停止当前运行的游戏

    留空 等待实现。

## 交互与UI

- 头部：标题、搜索框、按钮（刷新、加载外部玩法、停止当前运行的游戏）。
- 列表：网格卡片（自适应）。
- 操作：卡片右侧动作区（启动/删除）。
- 编辑模态框：表单输入与提交、取消；路径目前通过 `prompt` 简易输入（见“已知差异”）。
- 空态：无匹配或无数据时显示占位图与提示文案。

## 数据与存储

### file存储

### 游戏对象（示例）

{
  "id": "game-unique-id",
  "name": "玩法名称",
  "description": "玩法描述",
  "status": "stopped | running | finished | idle | error",
  "arguments": "可选启动参数",
  "configPath": "外部玩法文件路径",
  "requiredDevices": [{ "logicalId": "shock_device", "required": true, "name": "电击设备" }],
  "version": "1.0.0",
  "author": "作者",
  "createdAt": 1730000000000,
  "lastPlayed": 1730000000000
}

## 系统与集成

### 路由

- `/gameplay-config`：外部玩法启动前配置页面。
- `/gamelist`: 外部玩法列表页面

## 错误处理与边界

- 文件选择取消：直接返回不提示。
- 索引文件缺失/格式错误：记录日志、跳过自动加载。
- 玩法文件不存在或读取失败：跳过并提示；不阻断其他操作。
- 重名玩法：更新既有条目而不是重复添加。
- 设备依赖校验：在外部玩法启动流程中校验并错误提示。
